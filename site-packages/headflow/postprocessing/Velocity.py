from .PPField import PPField
from dolfin import Function, project, as_vector

class Velocity(PPField):
    def compute(self, pp, spaces, problem):
        # Hack to get given u in whatever format it has
        u = pp._u

        if not isinstance(u, Function):
            # Convert u into a Function if the scheme is segregated or mixed
            # TODO: With the subfunction assign feature we could do this faster
            #if not hasattr(self, "_u"):
            #    self._u = Function(spaces.V)
            #self._u.assign(u)
            #u = self._u
            u = project(as_vector(u), spaces.V)

        return u
