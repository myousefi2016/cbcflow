from .PPField import PPField
from dolfin import Function, project

class Pressure(PPField):
    def compute(self, pp, spaces, problem):
        # Hack to get given p in whatever format it has
        p = pp._p

        # TODO: Should we scale p by density here so we get the physical pressure in postprocessing?
        #       Or by a factor provided by the scheme?
        #       However the problem interface relates to the scaled pressure,
        #       as well as e.g. restarting.

        if not isinstance(p, Function):
            # TODO: With the subfunction assign feature we could do this faster
            #if not hasattr(self, "_p"):
            #    self._p = Function(spaces.Q)
            #self._p.assign(p)
            #p = self._p
            p = project(p, spaces.Q)

        return p
