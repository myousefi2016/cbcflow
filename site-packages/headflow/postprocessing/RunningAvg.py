from .MetaPPField import MetaPPField
from dolfin import *

class RunningAvg(MetaPPField):
    def before_first_compute(self, pp, spaces, problem):
        self._value = 0.0
        self._count = 0

    def compute(self, pp, spaces, problem):
        u = pp.get(self.valuename)

        if isinstance(self._value, float):
            self._value += u
        else:
            # TODO: Support fields, need to make a copy of underlying space.
            error("Only support scalars.")

        self._count += 1
        return self._value / self._count
