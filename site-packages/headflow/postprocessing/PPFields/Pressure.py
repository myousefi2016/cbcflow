
from dolfin import FunctionSpace, Function, project
from .ppfieldbase import PPFieldBase

class Pressure(PPFieldBase):
    def __init__(self, **kwargs):
        PPFieldBase.__init__(self, **kwargs)

    def before_first_update(self, u, p, t, timestep, problem):
        if not isinstance(p, Function):
            # FIXME: Hardcoded to 1 to make mixed code work! FIXME: Take spaces as input instead, here and in update
            self.Q = FunctionSpace(problem.mesh, "CG", 1)
            self.p = Function(self.Q, name="Pressure")

    def update(self, u, p, t, timestep, problem):
        # TODO: Streamline fetching of p in scalar function format
        if not isinstance(p, Function):
            self.p.assign(project(p, self.Q))
            p = self.p

        self.set_data(t, timestep, p)

