
from .MetaPPField import MetaPPField, MetaPPField2
from dolfin import *

class DiffL2norm(MetaPPField2):
    def compute(self, pp, spaces, problem):
        f = pp.get(self.valuename1)
        g = pp.get(self.valuename2)
        e = g - f

        dx = problem.dx

        f2 = assemble(f**2*dx(), mesh=problem.mesh)
        g2 = assemble(g**2*dx(), mesh=problem.mesh)
        e2 = assemble(e**2*dx(), mesh=problem.mesh)

        # TODO: Define the most useful relative norm here
        return sqrt(e2) / (0.5 * (sqrt(f2) + sqrt(g2)))
